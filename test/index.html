<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="./myscript.min.css"/>
<style>
#editor {
  background: grey;
  width: 500px;
  height: 500px;
}
</style>
<script type="module">
import MyScript from './myscript.esm.js';

var editorElement = document.getElementById('editor');

MyScript.register(editorElement, {
  recognitionParams: {
    type: 'MATH',
    protocol: 'WEBSOCKET',
    apiVersion: 'V4',
      server: {
        scheme: 'https',
        host: 'webdemoapi.myscript.com',
        applicationKey: '515131ab-35fa-411c-bb4d-3917e00faf60',
        hmacKey: '54b2ca8a-6752-469d-87dd-553bb450e9ad'
      },
      v4: {
        math: {
          mimeTypes: ['application/x-latex']
        }
      }
    }
});

/*
 * ES6 module creates a scope to avoid collision,
 * we need to define it explicitly on window.
 */
window.convert = function () {
  editorElement.editor.convert();
};

window.clear = function () {
  editorElement.editor.clear();
};

window.e = editorElement.editor;
// e.export_(['application/x-latex']);

editorElement.addEventListener("exported", function (evt) {
  const exports = evt.detail.exports;
  if (exports && exports['application/x-latex']) {
    const tex = exports['application/x-latex'];
    console.log('recognition: ' + tex);
  }
});

window.import_ = function () {
  const exampleEle = document.getElementById('example');
  const example = JSON.parse(exampleEle.value);
  console.log(example);
  editorElement.editor.pointerEvents(example);
};

window.export_ = function () {
  const exampleEle = document.getElementById('example');
  const strokes = editorElement.editor.model.rawStrokes;
  const allowed_keys = ['pointerId', 'pointerType', 'p', 't', 'y', 'x'];
  var filtered = [];
  strokes.forEach(function (stroke) {
    const tmp = allowed_keys.reduce((obj, key) => {
      obj[key]=stroke[key];
      return obj;
    }, {});
    filtered.push(tmp);
  });
  const wrapper = {"events": filtered};
  exampleEle.value = JSON.stringify(wrapper, null, 2);
};
</script>
</head>
<body>
<script>
</script>
<button onclick="window.clear()">clear</button>
<button onclick="window.convert()">convert</button>
<button onclick="window.import_()">import</button>
<button onclick="window.export_()">export</button>
<div id="editor"></div>

<textarea id="example" style="width: 500px; height: 500px;">
{
  "events": [{
    "pointerType": "mouse",
    "pointerId": 1,
    "x": [128, 125, 122, 119, 118, 117, 116, 117, 119, 123, 127, 135, 139, 141, 144, 144, 143, 142, 141, 142],
    "y": [83, 91, 99, 107, 114, 121, 125, 120, 112, 101, 90, 76, 70, 66, 76, 88, 101, 111, 118, 123],
    "t": [1516190046205, 1516190046247, 1516190046264, 1516190046280, 1516190046297, 1516190046314, 1516190046330, 1516190046380, 1516190046397, 1516190046413, 1516190046430, 1516190046447, 1516190046463, 1516190046480, 1516190046547, 1516190046563, 1516190046581, 1516190046597, 1516190046614, 1516190046630],
    "p": [0.5, 0.7076987214308235, 0.8060672826037246, 0.8060672826037246, 0.785875329883628, 0.785875329883628, 0.7185264889882718, 0.7461846839143089, 0.8024894359144054, 0.6578786777951477, 0.6578786777951477, 0.5984465727129564, 0.7880849230110567, 0.7292125754002905, 0.6768853685004259, 0.6535898384862245, 0.6389126863152722, 0.6829846120277299, 0.785875329883628, 0.7461846839143089]
  }, {
    "pointerType": "mouse",
    "pointerId": 1,
    "x": [117, 122, 128, 139, 146],
    "y": [105, 105, 106, 107, 106],
    "t": [1516190046870, 1516190046930, 1516190046947, 1516190046963, 1516190046980],
    "p": [0.5, 0.7763932022500211, 0.7681880209236327, 0.6676543814462531, 0.785875329883628]
  }]
}
</textarea>
<p>
version: MyScript v4.2.0 <br/>
ref: https://developer.myscript.com/docs/interactive-ink/1.2/web/web-components/math-element/editing
</p>
</body>
</html>
